<!DOCTYPE html>
<html>
<body>

	<input type="text" id="searchField" placeholder="Search query...">
	<button onclick="searchStreams()">Search</button> </br>

	<p id="total"></p>
	<button onclick="decreasePage()">Prev</button>
	<p id="page">1/1</p>
	<button onclick="increasePage()">Next</button> </br>
	<div id="streams" align = "center"></div>

<script id="updateSearch">

var baseURL = "https://api.twitch.tv/kraken/search/streams?limit=10&";
var callbackURL = ".json?count=10&callback=populate";
var currentOffset = 0;
var currentSearchURL = "";
var totalPages = 0;

function decreasePage(){
	if( currentSearchURL != "" && currentOffset >= 10 )
	{
		currentOffset -= 10;
		changePage();
	}
}

function increasePage(){
	if( currentSearchURL != "" && currentOffset < (totalPages * 10) )
	{
		currentOffset += 10;
		changePage();
	}
}

function createStreamDiv(streamData){
	var streamDiv = document.createElement("div");
	var linebreak = document.createElement("br");
    streamDiv.className = "stream-div";
    // Image
    var imageDiv = document.createElement("div");
    streamDiv.appendChild(imageDiv);
    var image = document.createElement("P");
    image.innerHTML = '<p><img src = "' + twitch['preview']['small'] +'"/>';
    imageDiv.appendChild(image);

    // Text
    var textDiv = document.createElement("div");
    streamDiv.appendChild(textDiv);
    var title = document.createElement("H1");
    title.innerText = twitch['channel']['display_name'];
    textDiv.appendChild(title);
    var nameAndViewers = document.createElement("P");
    nameAndViewers.innerText = twitch['game'] + " - " + twitch['viewers'];
    textDiv.appendChild(nameAndViewers);
    document.getElementById('streams').appendChild(streamDiv);
    document.getElementById('streams').appendChild(linebreak);
    streamDiv.clear
}

function populate(jsonpObj){
    var len = jsonpObj.streams.length;
    for(var i=0;i<len;i++){
        twitch = jsonpObj.streams[i];
        createStreamDiv(twitch);
    }

    var total = jsonpObj['_total'];
    totalPages = Math.ceil( total/10 );

    document.getElementById('total').innerHTML = "Total results: " + total;
    document.getElementById('page').innerHTML = ((currentOffset / 10) + 1) + "/" + totalPages;
 }

 function resetStreams(){
 	// Reset the streamsDiv
	document.getElementById('streams').innerHTML = "";
 }

 function changePage(){
 	resetStreams();
 	// Create a new script to call the populate function
 	var dynamicScript = document.createElement("script");
 	var pageURL = "";
 	if( currentOffset > 10 )
 	{
 		pageURL = "offset=" + currentOffset + "&";
 	}
	dynamicScript.src = baseURL + pageURL + currentSearchURL + callbackURL;
	document.getElementById('streams').appendChild(dynamicScript);
 }

 function searchStreams() {
 	resetStreams();
 	currentOffset = 0;
 	// Set to lowercase and replace the spaces with %20
 	var search = document.getElementById('searchField').value.toLowerCase();
 	currentSearchURL = "q=" + search.replace(/ /g, "%20");

 	// Create a new script to call the populate function
 	var dynamicScript = document.createElement("script");
	dynamicScript.src = baseURL + currentSearchURL + callbackURL;
	document.getElementById('streams').appendChild(dynamicScript);
 }

</script>

</body>
</html>